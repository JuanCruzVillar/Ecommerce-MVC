@model eCommerce.Entities.ViewModels.DetalleProductoPaginaViewModel

@{
    Layout = "~/Areas/Negocio/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Detalle del Producto";
}

<div class="container py-5">
    <div class="row">
        <div class="col-md-6 mb-4">
            <img class="img-fluid rounded shadow" src="@(Model.Producto.RutaImagen ?? "https://dummyimage.com/600x400/dee2e6/6c757d.jpg")"
                 alt="@Model.Producto.Nombre" style="object-fit:cover; width:100%; height:400px;" />
        </div>

        <div class="col-md-6">
            <h2 class="fw-bolder">@Model.Producto.Nombre</h2>
            <p class="text-muted">@Model.Producto.Descripcion</p>
            <h4 class="text-success">$@Model.Producto.Precio?.ToString("N2")</h4>

            <div class="mt-4 d-flex gap-2">
                <button class="btn btn-dark btn-lg agregar-carrito" data-producto="@Model.Producto.IdProducto">
                    Agregar al carrito
                </button>
                <a href="@Url.Action("Index", "Catalogo", new { area = "Negocio" })" class="btn btn-outline-secondary btn-lg">
                    Volver al catálogo
                </a>
            </div>
        </div>
    </div>

    <!-- Productos relacionados -->
    <section class="py-5 bg-light mt-5">
        <div class="container px-4 px-lg-5">
            <h2 class="fw-bolder mb-4">Productos relacionados</h2>
            <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                @foreach (var relacionado in Model.Relacionados)
                {
                    <div class="col mb-5">
                        <div class="card producto-card d-flex flex-column h-100">
                            <a href="@Url.Action("Detalle", "Catalogo", new { area = "Negocio", id = relacionado.IdProducto })" class="text-decoration-none text-dark">
                                <img class="card-img-top" src="@(relacionado.RutaImagen ?? "https://dummyimage.com/450x300/dee2e6/6c757d.jpg")"
                                     alt="@relacionado.Nombre" style="height:150px; object-fit:cover;" />
                            </a>
                            <div class="card-body p-3 text-center flex-grow-1 d-flex flex-column justify-content-between">
                                <div class="mb-2 text-truncate-2">
                                    <h6>@relacionado.Nombre</h6>
                                    <span>$@relacionado.Precio?.ToString("N2")</span>
                                </div>
                                <button class="btn btn-outline-dark btn-sm w-100 agregar-carrito" data-producto="@relacionado.IdProducto">
                                    Agregar al carrito
                                </button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
</div>

@section Scripts {
    <script>
        $(document).ready(function(){
            function actualizarBadge(){
                $.get('@Url.Action("Cantidad", "Carrito", new { area = "Negocio" })', function(total){
                    $('#carrito-badge').text(total);
                });
            }

            $('.agregar-carrito').click(function(){
                var productoId = $(this).data('producto');
                $.post('@Url.Action("Agregar", "Carrito", new { area = "Negocio" })', { productoId: productoId, cantidad:1 }, function(){
                    actualizarBadge();
                    Swal.fire({
                        position:'top-end',
                        icon:'success',
                        title:'Producto agregado al carrito',
                        showConfirmButton:false,
                        timer:1000
                    });
                });
            });
        });
    </script>
}
