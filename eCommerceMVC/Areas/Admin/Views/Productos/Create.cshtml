@using eCommerce.Entities.ViewModels
@model ProductoViewModel
@{
    ViewData["Title"] = "Crear Producto";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container-fluid px-4 py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-1 text-gray-800 fw-bold">
                        <i class="bi bi-box-seam text-success me-2"></i>Nuevo Producto
                    </h1>
                    <p class="text-muted mb-0">Completa los datos para crear un nuevo producto</p>
                </div>
                <a asp-action="Index" class="btn btn-secondary shadow-sm">
                    <i class="bi bi-arrow-left me-2"></i>Volver
                </a>
            </div>
        </div>
    </div>

    <!-- Mensajes de alerta -->
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>Error:</strong> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Card del formulario -->
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <form asp-action="Create" method="post" enctype="multipart/form-data">
                @Html.AntiForgeryToken()

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-info-circle me-2"></i>Información Básica
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label asp-for="Nombre" class="form-label">
                                    <i class="bi bi-tag me-1"></i>Nombre del Producto <span class="text-danger">*</span>
                                </label>
                                <input asp-for="Nombre" class="form-control" placeholder="Ej: Laptop Dell Inspiron 15" />
                                <span asp-validation-for="Nombre" class="text-danger small"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">
                                    <i class="bi bi-toggle-on me-1"></i>Estado
                                </label>
                                <div class="form-check form-switch mt-2">
                                    <input asp-for="Activo" class="form-check-input" type="checkbox" role="switch"
                                           id="switchActivo" style="width: 3em; height: 1.5em;" checked>
                                    <label class="form-check-label ms-2" for="switchActivo">
                                        <span id="labelActivo">Activo</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 mb-3">
                                <label asp-for="Descripcion" class="form-label">
                                    <i class="bi bi-text-paragraph me-1"></i>Descripción <span class="text-danger">*</span>
                                </label>
                                <textarea asp-for="Descripcion" class="form-control" rows="4"
                                          placeholder="Describe las características del producto..."></textarea>
                                <span asp-validation-for="Descripcion" class="text-danger small"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-success text-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-cash-coin me-2"></i>Precio y Stock
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Precio" class="form-label">
                                    <i class="bi bi-currency-dollar me-1"></i>Precio <span class="text-danger">*</span>
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input asp-for="Precio" type="number" step="0.01" class="form-control"
                                           placeholder="0.00" />
                                </div>
                                <span asp-validation-for="Precio" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Stock" class="form-label">
                                    <i class="bi bi-box me-1"></i>Stock <span class="text-danger">*</span>
                                </label>
                                <input asp-for="Stock" type="number" class="form-control"
                                       placeholder="Cantidad disponible" min="0" />
                                <span asp-validation-for="Stock" class="text-danger small"></span>
                                <small class="text-muted">
                                    <i class="bi bi-info-circle me-1"></i>Stock menor o igual a 10 se marcará como bajo
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-info text-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-diagram-3 me-2"></i>Clasificación
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="IdMarca" class="form-label">
                                    <i class="bi bi-award me-1"></i>Marca <span class="text-danger">*</span>
                                </label>
                                <select asp-for="IdMarca" asp-items="ViewBag.IdMarca" class="form-select">
                                    <option value="">-- Seleccione una Marca --</option>
                                </select>
                                <span asp-validation-for="IdMarca" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="IdCategoria" class="form-label">
                                    <i class="bi bi-folder me-1"></i>Categoría/Subcategoría <span class="text-danger">*</span>
                                </label>
                                <select asp-for="IdCategoria" asp-items="ViewBag.IdCategoria" class="form-select">
                                    <option value="">-- Seleccione Categoría/Subcategoría --</option>
                                </select>
                                <span asp-validation-for="IdCategoria" class="text-danger small"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-warning text-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-image me-2"></i>Imagen del Producto
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label asp-for="ImagenArchivo" class="form-label">
                                    <i class="bi bi-upload me-1"></i>Subir Imagen
                                </label>
                                <input type="file" asp-for="ImagenArchivo" class="form-control"
                                       accept="image/*" id="imagenInput" />
                                <small class="text-muted">
                                    <i class="bi bi-info-circle me-1"></i>Formatos permitidos: JPG, PNG, GIF. Tamaño máximo: 5MB
                                </small>
                            </div>
                            <div class="col-md-4 text-center">
                                <label class="form-label d-block">Vista Previa</label>
                                <div id="vistaPrevia" class="border rounded p-3 bg-light" style="min-height: 150px;">
                                    <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                                    <p class="text-muted small mb-0 mt-2">Sin imagen</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-end gap-2">
                            <a asp-action="Index" class="btn btn-secondary btn-lg">
                                <i class="bi bi-x-circle me-2"></i>Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-check-circle me-2"></i>Crear Producto
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function () {
            // Switch de estado activo
            $('#switchActivo').on('change', function () {
                const label = $(this).is(':checked') ? 'Activo' : 'Inactivo';
                $('#labelActivo').text(label);
            });

            // Vista previa de imagen
            $('#imagenInput').on('change', function (e) {
                const file = e.target.files[0];
                const vistaPrevia = $('#vistaPrevia');

                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        vistaPrevia.html(`
                            <img src="${e.target.result}"
                                 class="img-fluid rounded"
                                 style="max-height: 150px; object-fit: contain;"
                                 alt="Vista previa" />
                        `);
                    }
                    reader.readAsDataURL(file);
                } else {
                    vistaPrevia.html(`
                        <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted small mb-0 mt-2">Sin imagen</p>
                    `);
                }
            });

            // Auto-cerrar alertas
            setTimeout(function () {
                $('.alert').fadeOut('slow');
            }, 5000);
        });
    </script>

    <style>
        .card {
            border-radius: 0.5rem;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        .form-check-input:checked {
            background-color: #198754;
            border-color: #198754;
        }

        .form-check-input:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        #vistaPrevia {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .card-header h5 {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .input-group-text {
            background-color: #e9ecef;
            font-weight: 600;
        }
    </style>
}